<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width initial-scale=1.0 maximum-scale=1.0 user-scalable=no" />
<title>Green Express</title>
<link rel="icon" href="images/favicon.png" type="image/x-icon" />
<link rel="stylesheet" href="css/jquery-ui.css" />
<link rel="stylesheet" href="css/bootstrap.min.css" />
<link rel="stylesheet" href="css/bootstrap-theme.min.css" />
<link rel="stylesheet" href="font-awesome/css/font-awesome.min.css"/>
<link rel="stylesheet" href="css/style.css" />
<link rel="stylesheet" href="fonts/stylesheet.css" />
<script>

function refresh() {
         clearTimeout(timeout);
         //$('#notification_popup').modal(); 
         //checkUpdates();
         timeout = setTimeout(refresh,5000);
}

var timeout = setTimeout(refresh,5000);


</script>
</head>

<body class="general_page">
	<section class="fixed-wrap">
        <header><a href="account_management.html" class="user_acc"><img src="images/icon_acc_user.png" /></a><div class="title_page"><h1>Pending Orders</h1></div>
            <a href="javascript:logout();" class="user_logout"><i class="fa fa-power-off"></i></a>
        </header>
        <section class="search_bar">
            <div class="input-group">
              <input type="text" class="form-control" placeholder="Search">
              <span class="input-group-btn">
                <button class="btn btn-default" type="button"><i class="fa fa-search"></i></button>
              </span>
            </div>
        </section>
    </section>
    <section class="container paddown50">
        <div class="wrapper-box list_order">
        	<!--<a href="#notification_popup" data-toggle="modal">
        	<div class="row">
            	<div class="col-xs-3 padright0">
                	<div class="date_box">
                    	<div class="month">may</div>
                        <div class="date">12</div>
                        <div class="year">2015</div>
                    </div>
                </div>
                <div class="col-xs-4 padright0">
                	<h4>Pick and Go</h4>
                    <h3>$217.20</h3>
                    
                </div>
                <div class="col-xs-5">
                	<div class="indicator-green"><i class="fa fa-circle"></i></div>
                    <p>Pick and Go on 17/5 between 8am - 9am</p>
                </div>
            </div>
            </a><a href="#notification_popup" data-toggle="modal">
            <div class="row">
            	<div class="col-xs-3 padright0">
                	<div class="date_box">
                    	<div class="month">may</div>
                        <div class="date">12</div>
                        <div class="year">2015</div>
                    </div>
                </div>
                <div class="col-xs-4 padright0">
                	<h4>Delivery</h4>
                    <h3>$217.20</h3>
                </div>
                <div class="col-xs-5">
                	<div class="indicator-green"><i class="fa fa-circle"></i></div>
                    <p>Delivery on 17/5</p>
                </div>
            </div>
            </a>
            <a href="#notification_popup" data-toggle="modal">
            <div class="row">
            	<div class="col-xs-3 padright0">
                	<div class="date_box">
                    	<div class="month">may</div>
                        <div class="date">12</div>
                        <div class="year">2015</div>
                    </div>
                </div>
                <div class="col-xs-4 padright0">
                	<h4>Delivery</h4>
                    <h3>$217.20</h3>
                </div>
                <div class="col-xs-5">
                	<div class="indicator-red"><i class="fa fa-circle"></i></div>
                    <p>Pending Your Confirmation</p>
                </div>
            </div>
            </a>-->

            <!--<a href="#notification_popup" data-toggle="modal">
            <div class="row">
                <div class="col-xs-3 padright0">
                    <div class="date_box">
                        <div class="month">may</div>
                        <div class="date">12</div>
                        <div class="year">2015</div>
                    </div>
                </div>
                <div class="col-xs-4 padright0">
                    <h4>Pick and Go</h4>
                    <h3>$217.20</h3>
                </div>
                <div class="col-xs-5">
                    <div class="indicator-yellow"><i class="fa fa-circle"></i></div>
                    <p>Pending Quotation</p>
                </div>
            </div>
            </a>-->

        </div>
        
        <div id="notification_popup" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title">notification</h4>
                            </div>
                            <div class="modal-body">
                                <div class="text-center">
                                    <p>There has been changes to your order.<br />Please click to view the changes.</p>
                                    <div class="buttons">
                                    <a href="#delivery_order_ack" class="btn-glass-min btn-green marleft5" data-toggle="modal" data-dismiss="modal" aria-hidden="true">view changes</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="delivery_order_ack" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title">delivery order</h4>
                            </div>
                            <div class="modal-body">
                            	<div class="order_cart_box">
                                    <table class="table">
                                        <tr>
                                            <th>Item</th>
                                            <th>Qty</th>
                                            <th>Received</th>
                                        </tr>
                                        <tr>
                                            <td>Asparagus</td>
                                            <td><span>5kg</span></td>
                                            <td><input type="checkbox" class="checkbox large custom" checked /></td>
                                        </tr>
                                        <tr>
                                            <td>Apples</td>
                                            <td><span>8kg</span></td>
                                            <td><input type="checkbox" class="checkbox large custom" checked /></td>
                                        </tr>
                                        <tr>
                                            <td>Spinach</td>
                                            <td><span>10kg</span></td>
                                            <td><input type="checkbox" class="checkbox large custom" checked /></td>
                                        </tr>
                                        <tr>
                                            <td>Watermelon</td>
                                            <td><span>10pcs</span></td>
                                            <td><input type="checkbox" class="checkbox large custom" checked /></td>
                                        </tr>
                                        <tr>
                                            <td>Tomatoes</td>
                                            <td><span>6kg</span></td>
                                            <td><input type="checkbox" class="checkbox large custom" checked /></td>
                                        </tr>
                                        <tr>
                                            <td>Chinese Spinach</td>
                                            <td><span>6kg</span></td>
                                            <td><input type="checkbox" class="checkbox large custom" checked /></td>
                                        </tr>
                                        <tr>
                                            <td>Lotus Root</td>
                                            <td><span>2pcs</span></td>
                                            <td><input type="checkbox" class="checkbox large custom" checked /></td>
                                        </tr>
                                    </table>
                                </div>
                                <form class="forms padding0" data-toggle="validator" role="form">
                                	<textarea class="form-control no-round" placeholder="Remarks" data-match-error="This field is required" required></textarea>
                                <div class="text-center">
                                    <div class="buttons">
                                    <a href="#delivery_order_success" class="btn-glass-min btn-green marleft5" data-toggle="modal" data-dismiss="modal" aria-hidden="true">goods received</a>
                                    </div>
                                </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="pending_quot" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title">pending quotation<BR><span id="ordno"></span></h4>
                            </div>
                            <div class="modal-body">
                                <div class="order_cart_box" id="pending_orders_box">
                                    <!-- order items list -->
                                </div>                                
                            </div>
                        </div>
                    </div>
                </div>
                <div id="delivery_order_success" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title">successful</h4>
                            </div>
                            <div class="modal-body">
                                <div class="text-center">
                                    <p>We are pleased that you have received the goods. We look forward to your next order.</p>
                                    <div class="buttons">
                                    <a href="#" class="btn-glass-min btn-green marleft5" data-toggle="modal" data-dismiss="modal" aria-hidden="true">close</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
    </section>
    <nav class="menus">
        <div><a href="specials.html">specials</a></div>
        <div><a href="javascript:selected_product(1);">fruits</a></div>
        <div><a href="javascript:selected_product(2);">veg</a></div>
        <div><a href="order_cart_delivery.html"><div id="bublecart" class="bubbletip" ><span id="cartnum">0</span></div><img src="images/icon_cart.png" style="width:17px;" /></a></div>
        <div class="active"><a href="pending_order.html"><div id="bublepending" class="bubbletip" ><span id="pendnum">0</span></div>pending order</a></div>
        <div><a href="past_orders.html">past orders</a></div>
    </nav>

<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery-ui.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/validator.js"></script>
<script type="text/javascript" src="js/custom-scripts.js"></script>
<script type="text/javascript" src="js/lang.js"></script>
<script>$('#collection_date').datepicker();</script>
<script>
function checkConnection() {
    var networkState = navigator.connection.type;
    
    var states = {};
    states[Connection.UNKNOWN]  = 'Unknown connection';
    states[Connection.ETHERNET] = 'Ethernet connection';
    states[Connection.WIFI]     = 'WiFi connection';
    states[Connection.CELL_2G]  = 'none';
    states[Connection.CELL_3G]  = 'Cell 3G connection';
    states[Connection.CELL_4G]  = 'Cell 4G connection';
    states[Connection.CELL]     = 'Cell generic connection';
    states[Connection.NONE]     = 'none';
    
    if(states[networkState] === 'none'){

        return 0;
    
    }else{
        
        return 1; 
    }
}


function check_localdata_existed(order_id){

  var rs;var len
  var db = openDatabase('greenexpress', '1.0', 'Greenexpress DB', 2 * 1024 * 1024);
         
  db.transaction(function (tx) {
  tx.executeSql("SELECT count(id) as 'num' FROM ORDERS ", [], function (tx, results) {
    
   var len = results.rows.item(0).num;
   
   if(len>0){
       rs = 0;
   }else{
       rs = 1;
   }

 }, null);

});

  return len;

}

function load_orders_online(){
        
        var custid = localStorage.userid;
   
        
         $.getJSON( base_url + "/restapi/ordersapi/loadorders/customerid/"+custid+"/format/json", function( data ) {               
             
               

               var db = openDatabase('greenexpress', '1.0', 'Greenexpress DB', 2 * 1024 * 1024);
               var temp;

         db.transaction(function (tx) {  

              tx.executeSql('CREATE TABLE IF NOT EXISTS ORDERS (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, order_id INTEGER NOT NULL, reference_no VARCHAR(300), quotation_no VARCHAR(100), invoice_no VARCHAR(100), customer_id INTEGER NOT NULL,delivery_type char(1) NOT NULL ,delivery_date DATETIME NOT NULL, status char(1) NOT NULL, delivery_cost FLOAT, tax FLOAT, inv_total FLOAT, total FLOAT, admin_note VARCHAR(300), post_date DATETIME NOT NULL)');

              tx.executeSql('CREATE TABLE IF NOT EXISTS ORDERS_ITEMS (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, order_id INTEGER NOT NULL, product_id INTEGER NOT NULL, product_code VARCHAR(128), product_name VARCHAR(300), product_namecin VARCHAR(300),product_unit VARCHAR(50), quantity INT NOT NULL, unit_price FLOAT, tax, total)');

              tx.executeSql("delete FROM ORDERS ");
              tx.executeSql("delete FROM ORDERS_ITEMS ");
             
             var item_tax;
             var item_total;

             $.each( data, function( keyx, valx ) {              

             tx.executeSql("INSERT INTO ORDERS (order_id, reference_no, quotation_no, invoice_no, customer_id, delivery_type, delivery_date, status, delivery_cost, tax, inv_total, total, admin_note, post_date) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);", [valx.id, valx.reference_no, valx.quotation_no, valx.invoice_no, valx.customer_id, valx.delivery_type, valx.delivery_date, valx.order_status, valx.delivery_cost, valx.tax, valx.inv_total, valx.total, valx.internal_note, valx.post_date ]);

                item_tax = 0;
                item_total = 0;
                $.each( valx.items, function( key, val ) {
                     item_tax = (val.unit_price*val.quantity) * 0.07;
                     item_total = (val.unit_price*val.quantity) + item_tax;
                     tx.executeSql("INSERT INTO ORDERS_ITEMS (order_id, product_id, product_code, product_name, product_namecin, product_unit, quantity, unit_price, tax, total) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?);", [valx.id, val.product_id, val.product_code, val.product_name, val.product_namecin, val.product_unit, val.quantity, val.unit_price, item_tax, item_total ]);

                }); 


                
              });
              
              
                
                
         }); 

             
         });

        
}


function checkUpdates(){


         var custid = localStorage.userid;
   

         $.getJSON( base_url + "/restapi/ordersapi/checkupdate/customerid/"+custid+"/format/json", function( data ) {               

               var db = openDatabase('greenexpress', '1.0', 'Greenexpress DB', 2 * 1024 * 1024);
         db.transaction(function (tx) {  
              

               $.each( data, function( key, val ) {
                     //alert( value.product_name );
                     tx.executeSql('UPDATE orders' +
              ' SET status = ? , quotation_no = ? ' +
              ' WHERE order_id = ?',
              [val.order_status, val.quotation_no, val.id]);

               });

                
         }); 

             
         });
    
}

function clickact(order_id, order_status, order_no){
    
    if(order_status==1){
        $('#pending_quot').modal(); 
        showselectedOrder(order_id, order_no);
    }else if(order_status==2){
        localStorage.selected_pendorder = order_id;
        localStorage.selected_orderno = order_no;
        window.location=('quotation_delivery.html');
    }

}

function showselectedOrder(order_id, order_no){

        var db = openDatabase('greenexpress', '1.0', 'Greenexpress DB', 2 * 1024 * 1024);

        db.transaction(function (tx) {
  tx.executeSql('SELECT * FROM ORDERS_ITEMS WHERE order_id = '+order_id+' ORDER BY id', [], function (tx, results) {
   
   var content = '<table class="table"><tr><th>Item</th><th>Qty</th></tr>';
   
   var len = results.rows.length, i;
   $('#pending_orders_box').html('');
   for (i = 0; i < len; i++){
      //results.rows.item(i).id
      content = content + '<tr><td>'+addslashes(results.rows.item(i).product_name)+'</td><td><span>'+results.rows.item(i).quantity+'kg</span></td></tr>'; 

   }
   $('#ordno').html(' ( ORDER NO: '+order_no+')');
   $('#pending_orders_box').html(content+'</table>');

 }, null);

});

}

jQuery(document).ready(function(){
    
    //checkUpdates(); 
    load_orders_online();

    $('#qtyplus').click(function(e){
        e.preventDefault();
        fieldName = $(this).attr('field');
        var currentVal = parseInt($('#qtyfield').val());
        if (!isNaN(currentVal)) {
            $('#qtyfield').val(currentVal + 1);
        } else {
            $('#qtyfield').val(0);
        }
    });
    
    $("#qtyminus").click(function(e) {
        e.preventDefault();
        fieldName = $(this).attr('field');
        var currentVal = parseInt($('#qtyfield').val());
        if (!isNaN(currentVal) && currentVal > 0) {
            $('#qtyfield').val(currentVal - 1);
        } else {
            $('#qtyfield').val(0);
        }

    });

    
    //* load local cart data *//

function showRecords() {

  var db = openDatabase('greenexpress', '1.0', 'Greenexpress DB', 2 * 1024 * 1024);
  var month = [[]];
  month[1] = ["","January","February","March","April","May","June","July","August","September","October","November","December"];
  month[2] = ["","一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"];

  db.transaction(function (tx) {
  tx.executeSql('SELECT * FROM ORDERS WHERE status = 1 or status = 2  ORDER BY id DESC', [], function (tx, results) {
 
   var arrdate, arrdate2; 
   var content = '';
   var month_tmp = '';
   var del_type = 1;
   var len = results.rows.length, i;
   $('.list_order').html('');
   for (i = 0; i < len; i++){
      //alert(results.rows.item(i).post_date);
      arrdate2 = results.rows.item(i).post_date.split(" ");
      arrdate = arrdate2[0].split("-");
      month_tmp = month[localStorage.lang][parseInt(arrdate[1])];

      if(results.rows.item(i).delivery_type==1){
          del_type = "Delivery";
      }else{
          del_type = "Pick n Go";
      }

      content = content + '<a href="javascript:clickact('+results.rows.item(i).order_id+','+results.rows.item(i).status+', \''+results.rows.item(i).reference_no+'\');"><div class="row" data-id="'+results.rows.item(i).id+'" data-status="'+results.rows.item(i).status+'" ><div class="col-xs-3 padright0"><div class="date_box"><div class="month">'+month_tmp+'</div><div class="date">'+arrdate[2]+'</div><div class="year">'+arrdate[0]+'</div></div></div><div class="col-xs-4 padright0"><h4>'+del_type+'</h4><h3 id="price'+results.rows.item(i).id+'">'+results.rows.item(i).reference_no+'</h3></div><div class="col-xs-5"><div class="indicator-yellow"><i class="fa fa-circle"></i></div><p>'+statusdesc[localStorage.lang][results.rows.item(i).status]+'</p></div></div></a>'; 

   }
   localStorage.pendnum = len;
   $('.list_order').html(content);

 }, null);

});

}



showRecords();

    //* end load cart data *//


});

</script>
</body>
</html>
